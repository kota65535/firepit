vars:
  A: 1
  B: "{{ A | int + 1 }}"
  C: true

tasks:
  foo:
    command: echo "foo {{ A }}"
    depends_on:
      - bar
      - baz
      - "{% if C %}qux{% endif %}"

  bar:
    env:
      B: "{{ B | int + 1 }}"
    command: echo "bar ${B}"

  baz:
    vars:
      C: baz
    env_files:
      - .env.{{ C }}
    command: echo "baz ${C}"

  qux:
    vars:
      D: 12001
    command: |
      echo "qux {{ D }}"
      nc -kl 12001
    service:
      healthcheck:
        command: "nc -z localhost {{ D }}"
        start_period: 1
